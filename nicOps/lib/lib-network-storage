#!/bin/bash

function make_network_storage1()
{
    EX_ADDR=$1
    EX_GW_ADDR=$2
    MGMT_ADDR=$3
    STORAGE_ADDR=$4
    VXLAN_ADDR=$5
    REPLICA_ADDR=$6
    VLAN_ADDR=$7
    LBAAS_ADDR=$8
    IPOIB_ADDR=$9
    NODE=${10}
    NET_STR="# STORAGE $NODE : generated by devstack
#
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        eno1:
            addresses:
            - $storage1/24
            nameservers:
                addresses:
                - 10.2.0.12
                search:
                - maas
            mtu: 1500
        eno2: {}
        eno3: {}
        eno4: {}
        enp4s0f0: {}
        enp4s0f1: {}
        ibp3s0:
            addresses: [${STORAGE_ADDR}]

    bonds:
        bond0:
            interfaces:
                - enp4s0f0
                - enp4s0f1
            parameters:
                mode: 802.3ad
                mii-monitor-interval: 1
    vlans:
        vlan101:
            id: 101
            link: bond0
    bridges:
        br-public:
            interfaces: [eno2]
            addresses: [${EX_ADDR}]
            gateway4: ${EX_GW_ADDR}
            nameservers:
                addresses: [8.8.8.8]
            mtu: 1500
            dhcp4: no
            dhcp6: no
        br-mgmt:
            interfaces: [${VLAN_MGMT}]
            addresses: [${MGMT_ADDR}]
            mtu: ${FIBER_MTU}
            dhcp4: no
            dhcp6: no
    version: 2
    "
    cat << EOF > output/$NODE.net.conf
$NET_STR
EOF
}

function make_network_storage2()
{
    EX_ADDR=$1
    EX_GW_ADDR=$2
    MGMT_ADDR=$3
    STORAGE_ADDR=$4
    VXLAN_ADDR=$5
    REPLICA_ADDR=$6
    VLAN_ADDR=$7
    LBAAS_ADDR=$8
    IPOIB_ADDR=$9
    NODE=${10}
    NET_STR="# STORAGE $NODE : generated by devstack
#
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        eno1:
            addresses:
            - $storage2/24
            nameservers:
                addresses:
                - 10.2.0.12
                search:
                - maas
            mtu: 1500
        eno2: {}
        eno3: {}
        eno4: {}
        enp4s0f0: {}
        enp4s0f1: {}
        ibp3s0f0: {}
        ibp3s0f1: 
            addresses: [${STORAGE_ADDR}]

    bonds:
        bond0:
            interfaces:
                - enp4s0f0
                - enp4s0f1
            parameters:
                mode: 802.3ad
                mii-monitor-interval: 1
    vlans:
        vlan101:
            id: 101
            link: bond0
    bridges:
        br-public:
            interfaces: [eno2]
            addresses: [${EX_ADDR}]
            gateway4: ${EX_GW_ADDR}
            nameservers:
                addresses: [8.8.8.8]
            mtu: 1500
            dhcp4: no
            dhcp6: no
        br-mgmt:
            interfaces: [${VLAN_MGMT}]
            addresses: [${MGMT_ADDR}]
            mtu: ${FIBER_MTU}
            dhcp4: no
            dhcp6: no
    version: 2
    "
    cat << EOF > output/$NODE.net.conf
$NET_STR
EOF
}


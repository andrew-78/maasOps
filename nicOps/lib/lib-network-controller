#!/bin/bash

function make_network_controller1()
{
    EX_ADDR=$1
    EX_GW_ADDR=$2
    MGMT_ADDR=$3
    STORAGE_ADDR=$4
    VXLAN_ADDR=$5
    REPLICA_ADDR=$6
    VLAN_ADDR=$7
    NODE=$8

    NET_STR="# CONTROLLER $NODE : generated by devstack
#
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        eno1:
            addresses:
            - 10.2.0.206/24
            match:
                macaddress: 24:6e:96:27:60:44
            mtu: 1500
            nameservers:
                addresses:
                - 10.2.0.12
                search:
                - maas
            set-name: eno1
        eno2:
            match:
                macaddress: 24:6e:96:27:60:45
            mtu: 1500
            set-name: eno2
        eno3:
            match:
                macaddress: 24:6e:96:27:60:46
            mtu: 1500
            optional: true
            set-name: eno3
        eno4:
            match:
                macaddress: 24:6e:96:27:60:47
            mtu: 1500
            set-name: eno4
        enp129s0f0:
            match:
                macaddress: a0:36:9f:c7:25:34
            mtu: 1500
            set-name: enp129s0f0
        enp129s0f1:
            match:
                macaddress: a0:36:9f:c7:25:36
            mtu: 1500
            set-name: enp129s0f1
        ibp3s0: {}
        br-dummy0: {}
        br-dummy1: {}
    bonds:
        bond0:
            interfaces:
                - enp129s0f0
                - enp129s0f1
            parameters:
                mode: 802.3ad
                mii-monitor-interval: 1
    vlans:
        vlan101:
            id: 101
            link: bond0
        vlan102:
            id: 102
            link: bond0
        vlan103:
            id: 103
            link: bond0
    bridges:
        br-ex:
            interfaces: [eno2, br-dummy0]
            addresses: [${EX_ADDR}]
            nameservers:
                addresses: [8.8.8.8]
            routes:
                - to: 0.0.0.0/0
                  via: ${EX_GW_ADDR}
                  metric: 10
            dhcp4: no
            dhcp6: no
        br-mgmt:
            interfaces: [${VLAN_MGMT}]
            addresses: [${MGMT_ADDR}]
            dhcp4: no
            dhcp6: no
        br-storage:
            interfaces: [ibp3s0]
            addresses: [${STORAGE_ADDR}]
            mtu: ${MTU_STORAGE}
            dhcp4: no
            dhcp6: no
        br-vxlan:
            interfaces: [${VLAN_VXLAN}]
            addresses: [${VXLAN_ADDR}]
            dhcp4: no
            dhcp6: no
        br-replica:
            interfaces: [${VLAN_REPLICA}]
            addresses: [${REPLICA_ADDR}]
            dhcp4: no
            dhcp6: no
        br-vlan:
            interfaces: [bond0, br-dummy1]
            addresses: [${VLAN_ADDR}]
            dhcp4: no
            dhcp6: no
    version: 2
    "

    #echo "#-------------------------------------------------------------------"
    #echo "$NET_STR"

    cat << EOF > output/$NODE.net.conf
$NET_STR
EOF

}

function make_network_controller2()
{
    EX_ADDR=$1
    EX_GW_ADDR=$2
    MGMT_ADDR=$3
    STORAGE_ADDR=$4
    VXLAN_ADDR=$5
    REPLICA_ADDR=$6
    VLAN_ADDR=$7
    NODE=$8

    NET_STR="# CONTROLLER $NODE : generated by devstack
#
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        eno1:
            addresses:
            - 10.2.0.222/24
            match:
                macaddress: 24:6e:96:27:5b:d4
            mtu: 1500
            nameservers:
                addresses:
                - 10.2.0.12
                search:
                - maas
            set-name: eno1
        eno2:
            match:
                macaddress: 24:6e:96:27:5b:d5
            mtu: 1500
            set-name: eno2
        eno3:
            match:
                macaddress: 24:6e:96:27:5b:d6
            mtu: 1500
            optional: true
            set-name: eno3
        eno4:
            match:
                macaddress: 24:6e:96:27:5b:d7
            mtu: 1500
            set-name: eno4
        enp129s0f0:
            match:
                macaddress: a0:36:9f:c7:23:7c
            mtu: 1500
            set-name: enp129s0f0
        enp129s0f1:
            match:
                macaddress: a0:36:9f:c7:23:7e
            mtu: 1500
            set-name: enp129s0f1
        ibp4s0f0: {}
        ibp4s0f1: {}
        br-dummy0: {}
        br-dummy1: {}
    bonds:
        bond0:
            interfaces:
                - enp129s0f0
                - enp129s0f1
            parameters:
                mode: 802.3ad
                mii-monitor-interval: 1
    vlans:
        vlan101:
            id: 101
            link: bond0
        vlan102:
            id: 102
            link: bond0
        vlan103:
            id: 103
            link: bond0
    bridges:
        br-ex:
            interfaces: [eno2, br-dummy0]
            addresses: [${EX_ADDR}]
            nameservers:
                addresses: [8.8.8.8]
            routes:
                - to: 0.0.0.0/0
                  via: ${EX_GW_ADDR}
                  metric: 10
            dhcp4: no
            dhcp6: no
        br-mgmt:
            interfaces: [${VLAN_MGMT}]
            addresses: [${MGMT_ADDR}]
            dhcp4: no
            dhcp6: no
        br-storage:
            interfaces: [ibp4s0f0]
            addresses: [${STORAGE_ADDR}]
            mtu: ${MTU_STORAGE}
            dhcp4: no
            dhcp6: no
        br-vxlan:
            interfaces: [${VLAN_VXLAN}]
            addresses: [${VXLAN_ADDR}]
            dhcp4: no
            dhcp6: no
        br-replica:
            interfaces: [${VLAN_REPLICA}]
            addresses: [${REPLICA_ADDR}]
            dhcp4: no
            dhcp6: no
        br-vlan:
            interfaces: [bond0, br-dummy1]
            addresses: [${VLAN_ADDR}]
            dhcp4: no
            dhcp6: no
    version: 2
    "

    #echo "#-------------------------------------------------------------------"
    #echo "$NET_STR"

    cat << EOF > output/$NODE.net.conf
$NET_STR
EOF

}

function make_network_controller3()
{
    EX_ADDR=$1
    EX_GW_ADDR=$2
    MGMT_ADDR=$3
    STORAGE_ADDR=$4
    VXLAN_ADDR=$5
    REPLICA_ADDR=$6
    VLAN_ADDR=$7
    NODE=$8

    NET_STR="# CONTROLLER $NODE : generated by devstack
#
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        eno1:
            addresses:
            - 10.2.0.220/24
            match:
                macaddress: 24:6e:96:27:63:d8
            mtu: 1500
            nameservers:
                addresses:
                - 10.2.0.12
                search:
                - maas
            set-name: eno1
        eno2:
            match:
                macaddress: 24:6e:96:27:63:d9
            mtu: 1500
            set-name: eno2
        eno3:
            match:
                macaddress: 24:6e:96:27:63:da
            mtu: 1500
            optional: true
            set-name: eno3
        eno4:
            match:
                macaddress: 24:6e:96:27:63:db
            mtu: 1500
            set-name: eno4
        enp129s0f0:
            match:
                macaddress: a0:36:9f:c4:a1:9c
            mtu: 1500
            set-name: enp129s0f0
        enp129s0f1:
            match:
                macaddress: a0:36:9f:c4:a1:9e
            mtu: 1500
            set-name: enp129s0f1
        ibp4s0f0: {}
        ibp4s0f1: {}
        br-dummy0: {}
        br-dummy1: {}
    bonds:
        bond0:
            interfaces:
                - enp129s0f0
                - enp129s0f1
            parameters:
                mode: 802.3ad
                mii-monitor-interval: 1
    vlans:
        vlan101:
            id: 101
            link: bond0
        vlan102:
            id: 102
            link: bond0
        vlan103:
            id: 103
            link: bond0
    bridges:
        br-ex:
            interfaces: [eno2, br-dummy0]
            addresses: [${EX_ADDR}]
            nameservers:
                addresses: [8.8.8.8]
            routes:
                - to: 0.0.0.0/0
                  via: ${EX_GW_ADDR}
                  metric: 10
            dhcp4: no
            dhcp6: no
        br-mgmt:
            interfaces: [${VLAN_MGMT}]
            addresses: [${MGMT_ADDR}]
            dhcp4: no
            dhcp6: no
        br-storage:
            interfaces: [ibp4s0f0]
            addresses: [${STORAGE_ADDR}]
            mtu: ${MTU_STORAGE}
            dhcp4: no
            dhcp6: no
        br-vxlan:
            interfaces: [${VLAN_VXLAN}]
            addresses: [${VXLAN_ADDR}]
            dhcp4: no
            dhcp6: no
        br-replica:
            interfaces: [${VLAN_REPLICA}]
            addresses: [${REPLICA_ADDR}]
            dhcp4: no
            dhcp6: no
        br-vlan:
            interfaces: [bond0, br-dummy1]
            addresses: [${VLAN_ADDR}]
            dhcp4: no
            dhcp6: no
    version: 2
    "

    #echo "#-------------------------------------------------------------------"
    #echo "$NET_STR"

    cat << EOF > output/$NODE.net.conf
$NET_STR
EOF

}

